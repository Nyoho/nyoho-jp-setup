upstream tdiary {
       server localhost:8080;
}

server {
       #listen   80; ## listen for ipv4; this line is default and implied
       #listen   [::]:80 default_server ipv6only=on; ## listen for ipv6

       root /var/www/nyoho.jp;
       index index.html index.htm;

       server_name nyoho.jp;

       location ~ ^/diary/ {
               rewrite ([0-9\-]+)\.html$ /diary/index.rb?date=$1 last;
               proxy_pass http://tdiary;
       }
}
